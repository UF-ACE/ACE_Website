{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nimport { useCallback } from 'react';\nimport useGetList from '../../dataProvider/useGetList';\nimport { getStatusForInput as getDataStatus } from './referenceDataStatus';\nimport useTranslate from '../../i18n/useTranslate';\nimport useReference from '../useReference';\nimport usePaginationState from '../usePaginationState';\nimport { useSortState } from '..';\nimport useFilterState from '../useFilterState';\nimport useSelectionState from '../useSelectionState';\nimport { useResourceContext } from '../../core';\n\nvar defaultReferenceSource = function (resource, source) {\n  return resource + \"@\" + source;\n};\n\nvar defaultFilter = {};\n/**\n * A hook for choosing a reference record. Useful for foreign keys.\n *\n * This hook fetches the possible values in the reference resource\n * (using `dataProvider.getList()`), it returns the possible choices\n * as the `choices` attribute.\n *\n * @example\n * const {\n *      choices, // the available reference resource\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n * });\n *\n * The hook also allow to filter results. It returns a `setFilter`\n * function. It uses the value to create a filter\n * for the query - by default { q: [searchText] }. You can customize the mapping\n * searchText => searchQuery by setting a custom `filterToQuery` function option\n * You can also add a permanentFilter to further filter the result:\n *\n * @example\n * const {\n *      choices, // the available reference resource\n *      setFilter,\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n *      permanentFilter: {\n *          author: 'john'\n *      },\n *      filterToQuery: searchText => ({ title: searchText })\n * });\n */\n\nexport var useReferenceInputController = function (props) {\n  var _a;\n\n  var basePath = props.basePath,\n      input = props.input,\n      _b = props.page,\n      initialPage = _b === void 0 ? 1 : _b,\n      _c = props.perPage,\n      initialPerPage = _c === void 0 ? 25 : _c,\n      _d = props.filter,\n      filter = _d === void 0 ? defaultFilter : _d,\n      reference = props.reference,\n      filterToQuery = props.filterToQuery,\n      sortOverride = props.sort,\n      enableGetChoices = props.enableGetChoices;\n  var resource = useResourceContext(props);\n  var translate = useTranslate(); // pagination logic\n\n  var _e = usePaginationState({\n    page: initialPage,\n    perPage: initialPerPage\n  }),\n      pagination = _e.pagination,\n      setPagination = _e.setPagination,\n      page = _e.page,\n      setPage = _e.setPage,\n      perPage = _e.perPage,\n      setPerPage = _e.setPerPage; // sort logic\n\n\n  var _f = useSortState(sortOverride),\n      sort = _f.sort,\n      setSortObject = _f.setSort;\n\n  var setSort = useCallback(function (field, order) {\n    if (order === void 0) {\n      order = 'ASC';\n    }\n\n    setSortObject({\n      field: field,\n      order: order\n    });\n    setPage(1);\n  }, [setPage, setSortObject]); // filter logic\n\n  var _g = useFilterState({\n    permanentFilter: filter,\n    filterToQuery: filterToQuery\n  }),\n      filterValues = _g.filter,\n      setFilter = _g.setFilter;\n\n  var displayedFilters = []; // plus showFilter and hideFilter defined outside of the hook because\n  // they never change\n  // selection logic\n\n  var _h = useSelectionState(),\n      selectedIds = _h.selectedIds,\n      onSelect = _h.onSelect,\n      onToggleItem = _h.onToggleItem,\n      onUnselectItems = _h.onUnselectItems; // fetch possible values\n\n\n  var _j = useGetList(reference, pagination, sort, filterValues, {\n    action: 'CUSTOM_QUERY',\n    enabled: enableGetChoices ? enableGetChoices(filterValues) : true\n  }),\n      possibleValuesIds = _j.ids,\n      possibleValuesData = _j.data,\n      possibleValuesTotal = _j.total,\n      possibleValuesLoaded = _j.loaded,\n      possibleValuesLoading = _j.loading,\n      possibleValuesError = _j.error,\n      refetchGetList = _j.refetch; // fetch current value\n\n\n  var _k = useReference({\n    id: input.value,\n    reference: reference\n  }),\n      referenceRecord = _k.referenceRecord,\n      refetchReference = _k.refetch,\n      referenceError = _k.error,\n      referenceLoading = _k.loading,\n      referenceLoaded = _k.loaded; // add current value to possible sources\n\n\n  var finalIds, finalData, finalTotal;\n\n  if (!referenceRecord || possibleValuesIds.includes(input.value)) {\n    finalIds = possibleValuesIds;\n    finalData = possibleValuesData;\n    finalTotal = possibleValuesTotal;\n  } else {\n    finalIds = __spreadArray([input.value], possibleValuesIds, true);\n    finalData = __assign((_a = {}, _a[input.value] = referenceRecord, _a), possibleValuesData);\n    finalTotal = possibleValuesTotal + 1;\n  } // overall status\n\n\n  var dataStatus = getDataStatus({\n    input: input,\n    matchingReferences: Object.keys(finalData).map(function (id) {\n      return finalData[id];\n    }),\n    referenceRecord: referenceRecord,\n    translate: translate\n  });\n  var refetch = useCallback(function () {\n    refetchGetList();\n    refetchReference();\n  }, [refetchGetList, refetchReference]);\n  return {\n    // should match the ListContext shape\n    possibleValues: {\n      basePath: basePath,\n      data: finalData,\n      ids: finalIds,\n      total: finalTotal,\n      error: possibleValuesError,\n      loaded: possibleValuesLoaded,\n      loading: possibleValuesLoading,\n      hasCreate: false,\n      page: page,\n      setPage: setPage,\n      perPage: perPage,\n      setPerPage: setPerPage,\n      currentSort: sort,\n      setSort: setSort,\n      filterValues: filterValues,\n      displayedFilters: displayedFilters,\n      setFilters: setFilter,\n      showFilter: showFilter,\n      hideFilter: hideFilter,\n      selectedIds: selectedIds,\n      onSelect: onSelect,\n      onToggleItem: onToggleItem,\n      onUnselectItems: onUnselectItems,\n      refetch: refetch,\n      resource: resource\n    },\n    referenceRecord: {\n      data: referenceRecord,\n      loaded: referenceLoaded,\n      loading: referenceLoading,\n      error: referenceError,\n      refetch: refetchReference\n    },\n    dataStatus: {\n      error: dataStatus.error,\n      loading: dataStatus.waiting,\n      warning: dataStatus.warning\n    },\n    choices: finalIds.map(function (id) {\n      return finalData[id];\n    }),\n    // kept for backwards compatibility\n    // @deprecated to be removed in 4.0\n    error: dataStatus.error,\n    loading: possibleValuesLoading || referenceLoading,\n    loaded: possibleValuesLoaded && referenceLoaded,\n    filter: filterValues,\n    refetch: refetch,\n    setFilter: setFilter,\n    pagination: pagination,\n    setPagination: setPagination,\n    sort: sort,\n    setSort: setSortObject,\n    warning: dataStatus.warning\n  };\n};\n\nvar hideFilter = function () {};\n\nvar showFilter = function () {};","map":{"version":3,"sources":["/Users/cameronkeene/Documents/GitHub/ACE_Website/client/node_modules/ra-core/esm/controller/input/useReferenceInputController.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArray","to","from","pack","l","ar","Array","slice","concat","useCallback","useGetList","getStatusForInput","getDataStatus","useTranslate","useReference","usePaginationState","useSortState","useFilterState","useSelectionState","useResourceContext","defaultReferenceSource","resource","source","defaultFilter","useReferenceInputController","props","_a","basePath","input","_b","page","initialPage","_c","perPage","initialPerPage","_d","filter","reference","filterToQuery","sortOverride","sort","enableGetChoices","translate","_e","pagination","setPagination","setPage","setPerPage","_f","setSortObject","setSort","field","order","_g","permanentFilter","filterValues","setFilter","displayedFilters","_h","selectedIds","onSelect","onToggleItem","onUnselectItems","_j","action","enabled","possibleValuesIds","ids","possibleValuesData","data","possibleValuesTotal","total","possibleValuesLoaded","loaded","possibleValuesLoading","loading","possibleValuesError","error","refetchGetList","refetch","_k","id","value","referenceRecord","refetchReference","referenceError","referenceLoading","referenceLoaded","finalIds","finalData","finalTotal","includes","dataStatus","matchingReferences","keys","map","possibleValues","hasCreate","currentSort","setFilters","showFilter","hideFilter","waiting","warning","choices"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useCallback } from 'react';\nimport useGetList from '../../dataProvider/useGetList';\nimport { getStatusForInput as getDataStatus } from './referenceDataStatus';\nimport useTranslate from '../../i18n/useTranslate';\nimport useReference from '../useReference';\nimport usePaginationState from '../usePaginationState';\nimport { useSortState } from '..';\nimport useFilterState from '../useFilterState';\nimport useSelectionState from '../useSelectionState';\nimport { useResourceContext } from '../../core';\nvar defaultReferenceSource = function (resource, source) {\n    return resource + \"@\" + source;\n};\nvar defaultFilter = {};\n/**\n * A hook for choosing a reference record. Useful for foreign keys.\n *\n * This hook fetches the possible values in the reference resource\n * (using `dataProvider.getList()`), it returns the possible choices\n * as the `choices` attribute.\n *\n * @example\n * const {\n *      choices, // the available reference resource\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n * });\n *\n * The hook also allow to filter results. It returns a `setFilter`\n * function. It uses the value to create a filter\n * for the query - by default { q: [searchText] }. You can customize the mapping\n * searchText => searchQuery by setting a custom `filterToQuery` function option\n * You can also add a permanentFilter to further filter the result:\n *\n * @example\n * const {\n *      choices, // the available reference resource\n *      setFilter,\n * } = useReferenceInputController({\n *      input, // the input props\n *      resource: 'comments',\n *      reference: 'posts',\n *      source: 'post_id',\n *      permanentFilter: {\n *          author: 'john'\n *      },\n *      filterToQuery: searchText => ({ title: searchText })\n * });\n */\nexport var useReferenceInputController = function (props) {\n    var _a;\n    var basePath = props.basePath, input = props.input, _b = props.page, initialPage = _b === void 0 ? 1 : _b, _c = props.perPage, initialPerPage = _c === void 0 ? 25 : _c, _d = props.filter, filter = _d === void 0 ? defaultFilter : _d, reference = props.reference, filterToQuery = props.filterToQuery, sortOverride = props.sort, enableGetChoices = props.enableGetChoices;\n    var resource = useResourceContext(props);\n    var translate = useTranslate();\n    // pagination logic\n    var _e = usePaginationState({ page: initialPage, perPage: initialPerPage }), pagination = _e.pagination, setPagination = _e.setPagination, page = _e.page, setPage = _e.setPage, perPage = _e.perPage, setPerPage = _e.setPerPage;\n    // sort logic\n    var _f = useSortState(sortOverride), sort = _f.sort, setSortObject = _f.setSort;\n    var setSort = useCallback(function (field, order) {\n        if (order === void 0) { order = 'ASC'; }\n        setSortObject({ field: field, order: order });\n        setPage(1);\n    }, [setPage, setSortObject]);\n    // filter logic\n    var _g = useFilterState({\n        permanentFilter: filter,\n        filterToQuery: filterToQuery,\n    }), filterValues = _g.filter, setFilter = _g.setFilter;\n    var displayedFilters = [];\n    // plus showFilter and hideFilter defined outside of the hook because\n    // they never change\n    // selection logic\n    var _h = useSelectionState(), selectedIds = _h.selectedIds, onSelect = _h.onSelect, onToggleItem = _h.onToggleItem, onUnselectItems = _h.onUnselectItems;\n    // fetch possible values\n    var _j = useGetList(reference, pagination, sort, filterValues, {\n        action: 'CUSTOM_QUERY',\n        enabled: enableGetChoices ? enableGetChoices(filterValues) : true,\n    }), possibleValuesIds = _j.ids, possibleValuesData = _j.data, possibleValuesTotal = _j.total, possibleValuesLoaded = _j.loaded, possibleValuesLoading = _j.loading, possibleValuesError = _j.error, refetchGetList = _j.refetch;\n    // fetch current value\n    var _k = useReference({\n        id: input.value,\n        reference: reference,\n    }), referenceRecord = _k.referenceRecord, refetchReference = _k.refetch, referenceError = _k.error, referenceLoading = _k.loading, referenceLoaded = _k.loaded;\n    // add current value to possible sources\n    var finalIds, finalData, finalTotal;\n    if (!referenceRecord || possibleValuesIds.includes(input.value)) {\n        finalIds = possibleValuesIds;\n        finalData = possibleValuesData;\n        finalTotal = possibleValuesTotal;\n    }\n    else {\n        finalIds = __spreadArray([input.value], possibleValuesIds, true);\n        finalData = __assign((_a = {}, _a[input.value] = referenceRecord, _a), possibleValuesData);\n        finalTotal = possibleValuesTotal + 1;\n    }\n    // overall status\n    var dataStatus = getDataStatus({\n        input: input,\n        matchingReferences: Object.keys(finalData).map(function (id) { return finalData[id]; }),\n        referenceRecord: referenceRecord,\n        translate: translate,\n    });\n    var refetch = useCallback(function () {\n        refetchGetList();\n        refetchReference();\n    }, [refetchGetList, refetchReference]);\n    return {\n        // should match the ListContext shape\n        possibleValues: {\n            basePath: basePath,\n            data: finalData,\n            ids: finalIds,\n            total: finalTotal,\n            error: possibleValuesError,\n            loaded: possibleValuesLoaded,\n            loading: possibleValuesLoading,\n            hasCreate: false,\n            page: page,\n            setPage: setPage,\n            perPage: perPage,\n            setPerPage: setPerPage,\n            currentSort: sort,\n            setSort: setSort,\n            filterValues: filterValues,\n            displayedFilters: displayedFilters,\n            setFilters: setFilter,\n            showFilter: showFilter,\n            hideFilter: hideFilter,\n            selectedIds: selectedIds,\n            onSelect: onSelect,\n            onToggleItem: onToggleItem,\n            onUnselectItems: onUnselectItems,\n            refetch: refetch,\n            resource: resource,\n        },\n        referenceRecord: {\n            data: referenceRecord,\n            loaded: referenceLoaded,\n            loading: referenceLoading,\n            error: referenceError,\n            refetch: refetchReference,\n        },\n        dataStatus: {\n            error: dataStatus.error,\n            loading: dataStatus.waiting,\n            warning: dataStatus.warning,\n        },\n        choices: finalIds.map(function (id) { return finalData[id]; }),\n        // kept for backwards compatibility\n        // @deprecated to be removed in 4.0\n        error: dataStatus.error,\n        loading: possibleValuesLoading || referenceLoading,\n        loaded: possibleValuesLoaded && referenceLoaded,\n        filter: filterValues,\n        refetch: refetch,\n        setFilter: setFilter,\n        pagination: pagination,\n        setPagination: setPagination,\n        sort: sort,\n        setSort: setSortObject,\n        warning: dataStatus.warning,\n    };\n};\nvar hideFilter = function () { };\nvar showFilter = function () { };\n"]},"metadata":{},"sourceType":"module"}