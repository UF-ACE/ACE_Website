{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport { indexById, removeEmpty, useSafeSetState } from '../util';\nimport usePaginationState from './usePaginationState';\nimport useSortState from './useSortState';\nimport useSelectionState from './useSelectionState';\n/**\n * Handle filtering, sorting and pagination on local data.\n *\n * Returns the data and callbacks expected by <ListContext>.\n *\n * @example\n * const data = [\n *     { id: 1, name: 'Arnold' },\n *     { id: 2, name: 'Sylvester' },\n *     { id: 3, name: 'Jean-Claude' },\n * ]\n * const ids = [1, 2, 3];\n *\n * const MyComponent = () => {\n *     const listContext = useList({\n *         data,\n *         ids,\n *         basePath: '/resource';\n *         resource: 'resource';\n *     });\n *     return (\n *         <ListContextProvider value={listContext}>\n *             <Datagrid>\n *                 <TextField source=\"id\" />\n *                 <TextField source=\"name\" />\n *             </Datagrid>\n *         </ListContextProvider>\n *     );\n * };\n *\n * @param {UseListOptions} props\n * @param {Record[]} props.data An array of records\n * @param {Identifier[]} props.ids An array of the record identifiers\n * @param {Boolean} props.loaded: A boolean indicating whether the data has been loaded at least once\n * @param {Boolean} props.loading: A boolean indicating whether the data is being loaded\n * @param {Error | String} props.error: Optional. The error if any occurred while loading the data\n * @param {Object} props.filter: Optional. An object containing the filters applied on the data\n * @param {Number} props.page: Optional. The initial page index\n * @param {Number} props.perPage: Optional. The initial page size\n * @param {SortPayload} props.sort: Optional. The initial sort (field and order)\n */\n\nexport var useList = function (props) {\n  var data = props.data,\n      error = props.error,\n      _a = props.filter,\n      filter = _a === void 0 ? defaultFilter : _a,\n      ids = props.ids,\n      loaded = props.loaded,\n      loading = props.loading,\n      _b = props.page,\n      initialPage = _b === void 0 ? 1 : _b,\n      _c = props.perPage,\n      initialPerPage = _c === void 0 ? 1000 : _c,\n      _d = props.sort,\n      initialSort = _d === void 0 ? defaultSort : _d;\n\n  var _e = useSafeSetState(loading),\n      loadingState = _e[0],\n      setLoadingState = _e[1];\n\n  var _f = useSafeSetState(loaded),\n      loadedState = _f[0],\n      setLoadedState = _f[1];\n\n  var _g = useSafeSetState(function () {\n    return {\n      data: indexById(data),\n      ids: ids,\n      total: ids.length\n    };\n  }),\n      finalItems = _g[0],\n      setFinalItems = _g[1]; // pagination logic\n\n\n  var _h = usePaginationState({\n    page: initialPage,\n    perPage: initialPerPage\n  }),\n      page = _h.page,\n      setPage = _h.setPage,\n      perPage = _h.perPage,\n      setPerPage = _h.setPerPage; // sort logic\n\n\n  var _j = useSortState(initialSort),\n      sort = _j.sort,\n      setSortObject = _j.setSort;\n\n  var setSort = useCallback(function (field, order) {\n    if (order === void 0) {\n      order = 'ASC';\n    }\n\n    setSortObject({\n      field: field,\n      order: order\n    });\n    setPage(1);\n  }, [setPage, setSortObject]); // selection logic\n\n  var _k = useSelectionState(),\n      selectedIds = _k.selectedIds,\n      onSelect = _k.onSelect,\n      onToggleItem = _k.onToggleItem,\n      onUnselectItems = _k.onUnselectItems; // filter logic\n\n\n  var filterRef = useRef(filter);\n\n  var _l = useSafeSetState({}),\n      displayedFilters = _l[0],\n      setDisplayedFilters = _l[1];\n\n  var _m = useSafeSetState(filter),\n      filterValues = _m[0],\n      setFilterValues = _m[1];\n\n  var hideFilter = useCallback(function (filterName) {\n    setDisplayedFilters(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n    setFilterValues(function (previousState) {\n      var _a = previousState,\n          _b = filterName,\n          _ = _a[_b],\n          newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n      return newState;\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    setDisplayedFilters(function (previousState) {\n      var _a;\n\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a));\n    });\n    setFilterValues(function (previousState) {\n      var _a;\n\n      return removeEmpty(__assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a)));\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var setFilters = useCallback(function (filters, displayedFilters) {\n    setFilterValues(removeEmpty(filters));\n\n    if (displayedFilters) {\n      setDisplayedFilters(displayedFilters);\n    }\n\n    setPage(1);\n  }, [setDisplayedFilters, setFilterValues, setPage]); // handle filter prop change\n\n  useEffect(function () {\n    if (!isEqual(filter, filterRef.current)) {\n      filterRef.current = filter;\n      setFilterValues(filter);\n    }\n  }); // We do all the data processing (filtering, sorting, paginating) client-side\n\n  useEffect(function () {\n    if (!loaded) return; // 1. filter\n\n    var tempData = data.filter(function (record) {\n      return Object.entries(filterValues).every(function (_a) {\n        var filterName = _a[0],\n            filterValue = _a[1];\n        var recordValue = get(record, filterName);\n        var result = Array.isArray(recordValue) ? Array.isArray(filterValue) ? recordValue.some(function (item) {\n          return filterValue.includes(item);\n        }) : recordValue.includes(filterValue) : Array.isArray(filterValue) ? filterValue.includes(recordValue) : filterValue == recordValue; // eslint-disable-line eqeqeq\n\n        return result;\n      });\n    });\n    var filteredLength = tempData.length; // 2. sort\n\n    if (sort.field) {\n      tempData = tempData.sort(function (a, b) {\n        if (get(a, sort.field) > get(b, sort.field)) {\n          return sort.order === 'ASC' ? 1 : -1;\n        }\n\n        if (get(a, sort.field) < get(b, sort.field)) {\n          return sort.order === 'ASC' ? -1 : 1;\n        }\n\n        return 0;\n      });\n    } // 3. paginate\n\n\n    tempData = tempData.slice((page - 1) * perPage, page * perPage);\n    var finalData = indexById(tempData);\n    var finalIds = tempData.filter(function (data) {\n      return typeof data !== 'undefined';\n    }).map(function (data) {\n      return data.id;\n    });\n    setFinalItems({\n      data: finalData,\n      ids: finalIds,\n      total: filteredLength\n    });\n  }, [data, filterValues, loaded, page, perPage, setFinalItems, sort.field, sort.order]);\n  useEffect(function () {\n    if (loaded !== loadedState) {\n      setLoadedState(loaded);\n    }\n  }, [loaded, loadedState, setLoadedState]);\n  useEffect(function () {\n    if (loading !== loadingState) {\n      setLoadingState(loading);\n    }\n  }, [loading, loadingState, setLoadingState]);\n  return {\n    currentSort: sort,\n    data: finalItems.data,\n    error: error,\n    displayedFilters: displayedFilters,\n    filterValues: filterValues,\n    hideFilter: hideFilter,\n    ids: finalItems.ids,\n    loaded: loadedState,\n    loading: loadingState,\n    onSelect: onSelect,\n    onToggleItem: onToggleItem,\n    onUnselectItems: onUnselectItems,\n    page: page,\n    perPage: perPage,\n    selectedIds: selectedIds,\n    setFilters: setFilters,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    showFilter: showFilter,\n    total: finalItems.total\n  };\n};\nvar defaultFilter = {};\nvar defaultSort = {\n  field: null,\n  order: null\n};","map":{"version":3,"sources":["/Users/cameronkeene/Documents/GitHub/ACE_Website/client/node_modules/ra-core/esm/controller/useList.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useCallback","useEffect","useRef","get","isEqual","indexById","removeEmpty","useSafeSetState","usePaginationState","useSortState","useSelectionState","useList","props","data","error","_a","filter","defaultFilter","ids","loaded","loading","_b","page","initialPage","_c","perPage","initialPerPage","_d","sort","initialSort","defaultSort","_e","loadingState","setLoadingState","_f","loadedState","setLoadedState","_g","total","finalItems","setFinalItems","_h","setPage","setPerPage","_j","setSortObject","setSort","field","order","_k","selectedIds","onSelect","onToggleItem","onUnselectItems","filterRef","_l","displayedFilters","setDisplayedFilters","_m","filterValues","setFilterValues","hideFilter","filterName","previousState","_","newState","showFilter","defaultValue","setFilters","filters","current","tempData","record","entries","every","filterValue","recordValue","result","Array","isArray","some","item","includes","filteredLength","a","b","slice","finalData","finalIds","map","id","currentSort"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useCallback, useEffect, useRef } from 'react';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport { indexById, removeEmpty, useSafeSetState } from '../util';\nimport usePaginationState from './usePaginationState';\nimport useSortState from './useSortState';\nimport useSelectionState from './useSelectionState';\n/**\n * Handle filtering, sorting and pagination on local data.\n *\n * Returns the data and callbacks expected by <ListContext>.\n *\n * @example\n * const data = [\n *     { id: 1, name: 'Arnold' },\n *     { id: 2, name: 'Sylvester' },\n *     { id: 3, name: 'Jean-Claude' },\n * ]\n * const ids = [1, 2, 3];\n *\n * const MyComponent = () => {\n *     const listContext = useList({\n *         data,\n *         ids,\n *         basePath: '/resource';\n *         resource: 'resource';\n *     });\n *     return (\n *         <ListContextProvider value={listContext}>\n *             <Datagrid>\n *                 <TextField source=\"id\" />\n *                 <TextField source=\"name\" />\n *             </Datagrid>\n *         </ListContextProvider>\n *     );\n * };\n *\n * @param {UseListOptions} props\n * @param {Record[]} props.data An array of records\n * @param {Identifier[]} props.ids An array of the record identifiers\n * @param {Boolean} props.loaded: A boolean indicating whether the data has been loaded at least once\n * @param {Boolean} props.loading: A boolean indicating whether the data is being loaded\n * @param {Error | String} props.error: Optional. The error if any occurred while loading the data\n * @param {Object} props.filter: Optional. An object containing the filters applied on the data\n * @param {Number} props.page: Optional. The initial page index\n * @param {Number} props.perPage: Optional. The initial page size\n * @param {SortPayload} props.sort: Optional. The initial sort (field and order)\n */\nexport var useList = function (props) {\n    var data = props.data, error = props.error, _a = props.filter, filter = _a === void 0 ? defaultFilter : _a, ids = props.ids, loaded = props.loaded, loading = props.loading, _b = props.page, initialPage = _b === void 0 ? 1 : _b, _c = props.perPage, initialPerPage = _c === void 0 ? 1000 : _c, _d = props.sort, initialSort = _d === void 0 ? defaultSort : _d;\n    var _e = useSafeSetState(loading), loadingState = _e[0], setLoadingState = _e[1];\n    var _f = useSafeSetState(loaded), loadedState = _f[0], setLoadedState = _f[1];\n    var _g = useSafeSetState(function () { return ({\n        data: indexById(data),\n        ids: ids,\n        total: ids.length,\n    }); }), finalItems = _g[0], setFinalItems = _g[1];\n    // pagination logic\n    var _h = usePaginationState({\n        page: initialPage,\n        perPage: initialPerPage,\n    }), page = _h.page, setPage = _h.setPage, perPage = _h.perPage, setPerPage = _h.setPerPage;\n    // sort logic\n    var _j = useSortState(initialSort), sort = _j.sort, setSortObject = _j.setSort;\n    var setSort = useCallback(function (field, order) {\n        if (order === void 0) { order = 'ASC'; }\n        setSortObject({ field: field, order: order });\n        setPage(1);\n    }, [setPage, setSortObject]);\n    // selection logic\n    var _k = useSelectionState(), selectedIds = _k.selectedIds, onSelect = _k.onSelect, onToggleItem = _k.onToggleItem, onUnselectItems = _k.onUnselectItems;\n    // filter logic\n    var filterRef = useRef(filter);\n    var _l = useSafeSetState({}), displayedFilters = _l[0], setDisplayedFilters = _l[1];\n    var _m = useSafeSetState(filter), filterValues = _m[0], setFilterValues = _m[1];\n    var hideFilter = useCallback(function (filterName) {\n        setDisplayedFilters(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n        setFilterValues(function (previousState) {\n            var _a = previousState, _b = filterName, _ = _a[_b], newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n            return newState;\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var showFilter = useCallback(function (filterName, defaultValue) {\n        setDisplayedFilters(function (previousState) {\n            var _a;\n            return (__assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a)));\n        });\n        setFilterValues(function (previousState) {\n            var _a;\n            return removeEmpty(__assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a)));\n        });\n    }, [setDisplayedFilters, setFilterValues]);\n    var setFilters = useCallback(function (filters, displayedFilters) {\n        setFilterValues(removeEmpty(filters));\n        if (displayedFilters) {\n            setDisplayedFilters(displayedFilters);\n        }\n        setPage(1);\n    }, [setDisplayedFilters, setFilterValues, setPage]);\n    // handle filter prop change\n    useEffect(function () {\n        if (!isEqual(filter, filterRef.current)) {\n            filterRef.current = filter;\n            setFilterValues(filter);\n        }\n    });\n    // We do all the data processing (filtering, sorting, paginating) client-side\n    useEffect(function () {\n        if (!loaded)\n            return;\n        // 1. filter\n        var tempData = data.filter(function (record) {\n            return Object.entries(filterValues).every(function (_a) {\n                var filterName = _a[0], filterValue = _a[1];\n                var recordValue = get(record, filterName);\n                var result = Array.isArray(recordValue)\n                    ? Array.isArray(filterValue)\n                        ? recordValue.some(function (item) { return filterValue.includes(item); })\n                        : recordValue.includes(filterValue)\n                    : Array.isArray(filterValue)\n                        ? filterValue.includes(recordValue)\n                        : filterValue == recordValue; // eslint-disable-line eqeqeq\n                return result;\n            });\n        });\n        var filteredLength = tempData.length;\n        // 2. sort\n        if (sort.field) {\n            tempData = tempData.sort(function (a, b) {\n                if (get(a, sort.field) > get(b, sort.field)) {\n                    return sort.order === 'ASC' ? 1 : -1;\n                }\n                if (get(a, sort.field) < get(b, sort.field)) {\n                    return sort.order === 'ASC' ? -1 : 1;\n                }\n                return 0;\n            });\n        }\n        // 3. paginate\n        tempData = tempData.slice((page - 1) * perPage, page * perPage);\n        var finalData = indexById(tempData);\n        var finalIds = tempData\n            .filter(function (data) { return typeof data !== 'undefined'; })\n            .map(function (data) { return data.id; });\n        setFinalItems({\n            data: finalData,\n            ids: finalIds,\n            total: filteredLength,\n        });\n    }, [\n        data,\n        filterValues,\n        loaded,\n        page,\n        perPage,\n        setFinalItems,\n        sort.field,\n        sort.order,\n    ]);\n    useEffect(function () {\n        if (loaded !== loadedState) {\n            setLoadedState(loaded);\n        }\n    }, [loaded, loadedState, setLoadedState]);\n    useEffect(function () {\n        if (loading !== loadingState) {\n            setLoadingState(loading);\n        }\n    }, [loading, loadingState, setLoadingState]);\n    return {\n        currentSort: sort,\n        data: finalItems.data,\n        error: error,\n        displayedFilters: displayedFilters,\n        filterValues: filterValues,\n        hideFilter: hideFilter,\n        ids: finalItems.ids,\n        loaded: loadedState,\n        loading: loadingState,\n        onSelect: onSelect,\n        onToggleItem: onToggleItem,\n        onUnselectItems: onUnselectItems,\n        page: page,\n        perPage: perPage,\n        selectedIds: selectedIds,\n        setFilters: setFilters,\n        setPage: setPage,\n        setPerPage: setPerPage,\n        setSort: setSort,\n        showFilter: showFilter,\n        total: finalItems.total,\n    };\n};\nvar defaultFilter = {};\nvar defaultSort = { field: null, order: null };\n"]},"metadata":{},"sourceType":"module"}